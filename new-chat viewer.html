<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MKVK Chat Viewer</title>

<style>
/* ===== GLOBAL BACKGROUND ===== */
html, body{
    margin:0;
    padding:0;
    min-height:100%;
    font-family:"Segoe UI", system-ui, sans-serif;

    background:#000;
    background-attachment: fixed;
    background-size: cover;
    background-position: center;
}

/* ===== FIXED HEADER ===== */
header{
    position:fixed;
    top:0;
    left:0;
    right:0;
    z-index:100;

    background:#0b3c49;
    color:white;
    padding:14px;
    text-align:center;
    font-size:18px;
    font-weight:600;
}

/* ===== CONTROLS ===== */
.controls{
    margin-top:60px; /* space for fixed header */
    padding:12px;
    border-bottom:1px solid rgba(255,255,255,0.15);
    background:transparent;
}

.controls label{
    display:block;
    font-size:13px;
    color:white;
    opacity:0.85;
    margin-top:8px;
}

.controls input,
.controls button{
    margin-top:4px;
    padding:8px 12px;
    border-radius:20px;
    border:none;
    outline:none;
}

.controls input{
    background:rgba(255,255,255,0.9);
}

.controls button{
    background:#25d366;
    color:white;
    font-weight:600;
    cursor:pointer;
}

/* ===== CHAT ===== */
#chat{
    max-width:820px;
    margin:auto;
    padding:20px;
}

/* ===== DATE ===== */
.date{
    text-align:center;
    font-size:12px;
    color:white;
    opacity:0.75;
    margin:18px 0;
}

/* ===== MESSAGE BUBBLE ===== */
.msg{
    max-width:70%;
    padding:12px 14px;
    border-radius:16px;
    margin:6px 0;
    clear:both;
    box-shadow:0 2px 6px rgba(0,0,0,0.35);
}

/* ===== SENDER (RIGHT – PINK) ===== */
.me{
    float:right;
    background:#f06292;
    color:white;
    border-bottom-right-radius:4px;
}

/* ===== RECEIVER (LEFT – BLUE) ===== */
.other{
    float:left;
    background:#4fa3ff;
    color:white;
    border-bottom-left-radius:4px;
}

/* ===== NAME ===== */
.name{
    font-size:11px;
    font-weight:600;
    margin-bottom:4px;
    opacity:0.9;
}

/* ===== TIME ===== */
.time{
    font-size:10px;
    opacity:0.6;
    text-align:right;
    margin-top:6px;
}

/* ===== EXPORT PDF ===== */
@media print{
    header, .controls{
        display:none;
    }
    html, body{
        background:white !important;
    }
}
</style>
</head>

<body>

<header>MKVK Chat Viewer</header>

<div class="controls">
    <label>Your name (exactly as in WhatsApp)</label>
    <input id="me" placeholder="Eg: Vijay">

    <label>Upload WhatsApp chat (.txt)</label>
    <input type="file" id="file" accept=".txt">

    <label>Upload chat background image</label>
    <input type="file" accept="image/*" onchange="setBG(this)">

    <br><br>
    <button onclick="exportChat()">Export Chat</button>
</div>

<div id="chat"></div>

<script>
function setBG(input){
    const f = input.files[0];
    if(!f) return;

    const r = new FileReader();
    r.onload = () => {
        document.documentElement.style.backgroundImage = `url('${r.result}')`;
        document.body.style.backgroundImage = `url('${r.result}')`;
    };
    r.readAsDataURL(f);
}

document.getElementById("file").addEventListener("change", loadChat);

function loadChat(){
    const myName = document.getElementById("me").value.trim();
    const file = document.getElementById("file").files[0];

    if(!myName || !file){
        alert("Enter your name and upload chat file");
        return;
    }

    const reader = new FileReader();
    reader.onload = () => parseChat(reader.result, myName);
    reader.readAsText(file);
}

function parseChat(text, myName){
    const chat = document.getElementById("chat");
    chat.innerHTML = "";
    let lastDate = "";

    text.split(/\r?\n/).forEach(line=>{
        const regex = /^(\d{1,2}[\/.-]\d{1,2}[\/.-]\d{2,4}),?\s(\d{1,2}:\d{2})(?:\s?(AM|PM|am|pm))?\s[-–]\s([^:]+):\s([\s\S]*)$/;
        const m = line.match(regex);
        if(!m) return;

        const date = m[1];
        const time = m[2] + (m[3] ? " " + m[3] : "");
        const name = m[4].trim();
        const msg = m[5];

        if(date !== lastDate){
            const d = document.createElement("div");
            d.className = "date";
            d.textContent = date;
            chat.appendChild(d);
            lastDate = date;
        }

        const bubble = document.createElement("div");
        bubble.className = "msg " + (name === myName ? "me" : "other");

        bubble.innerHTML =
            (name !== myName ? `<div class="name">${name}</div>` : "") +
            `<div>${msg}</div>` +
            `<div class="time">${time}</div>`;

        chat.appendChild(bubble);
    });
}

function exportChat(){
    window.print();
}
</script>

</body>
</html>